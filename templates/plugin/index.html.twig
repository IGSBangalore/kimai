{% extends 'base.html.twig' %}
{% import "macros/widgets.html.twig" as widgets %}
{% import "macros/actions.html.twig" as actions %}

{% block page_title %}{{ 'plugins.title'|trans({}, 'plugins') }}{% endblock %}
{% block page_subtitle %}{{ 'plugins.subtitle'|trans({}, 'plugins') }}{% endblock %}
{% block page_actions %}{{ actions.plugins('index') }}{% endblock %}

{% block main %}

{% if plugins|length == 0 %}
    {{ widgets.callout('warning', 'plugin.none_installed'|trans({}, 'plugins')) }}
{% else %}
    <div class="box data_table" id="datatable_plugins">
        <div class="box-body no-padding">
            <div class="dataTables_wrapper form-inline dt-bootstrap">
                <div class="row">
                    <div class="col-sm-12">
                        <table class="table table-striped table-hover dataTable" role="grid">
                            <thead>
                            <tr>
                                <th>{{ 'label.name'|trans }}</th>
                                <th>{{ 'label.licensed'|trans({}, 'plugins') }}</th>
                                <th class="hidden-xs">{{ 'label.valid_until'|trans({}, 'plugins') }}</th>
                                <th class="hidden-xs hidden-sm">{{ 'label.required_version'|trans({}, 'plugins') }}</th>
                                <th>{{ 'label.actions'|trans }}</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for plugin in plugins %}
                                <tr>
                                    <td>{{ plugin.name }} {{ plugin.metadata.version }}</td>
                                    <td>
                                        {% if plugin.licensed %}
                                            {{ widgets.label('yes', 'success') }}
                                        {% else %}
                                            {{ widgets.label('no', 'danger') }}
                                        {% endif %}
                                    </td>
                                    <td class="hidden-xs">
                                        {% if plugin.expired %}
                                            {% if plugin.license %}
                                                {{ widgets.label(plugin.license.validUntil|date_full, 'warning') }}
                                            {% else %}
                                                {{ widgets.label('no' , 'danger') }}
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                    <td class="hidden-xs hidden-sm">
                                        {% if plugin.metadata.kimaiVersion > constant('App\\Constants::VERSION') %}
                                            {{ widgets.label(plugin.metadata.kimaiVersion, 'danger') }}
                                        {% elseif plugin.metadata.kimaiVersion < constant('App\\Constants::VERSION') %}
                                            {{ widgets.label(plugin.metadata.kimaiVersion, 'warning') }}
                                        {% else %}
                                            {{ widgets.label(plugin.metadata.kimaiVersion, 'success') }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ actions.plugin(plugin, 'index') }}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}

<div class="form-group">
    <label class="control-label" for="license_key">{{ 'label.license_key'|trans({}, 'plugins') }}</label>
    <div class="input-group">
        <div class="input-group-addon" onclick="$('#license_key').select();document.execCommand('copy');">
            <i class="fas fa-key"></i>
        </div>
        <input type="text" id="license_key" class="form-control" disabled="disabled" value="{{ publicKey }}">
    </div>
</div>

{% endblock %}
